<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://unpkg.com/dexie@latest/dist/dexie.min.js"></script>
    <script src="/admin/js/database/db.js"></script>
    <script src="/admin/js/database/esportsteams.js"></script>
    <script src="/admin/js/database/position.js"></script>
    <script src="/admin/js/database/legend.js"></script>
    <script src="/admin/js/database/showdb.js"></script>
    <script src="/admin/js/script.js"></script>
    <link href="/admin/css/adminl.css" rel="stylesheet">
    <link href="/admin/css/header.css" rel="stylesheet">
    <title>Admin - Legends</title>
</head>
<div id="header"></div>
<body>
    <div class="player_zone">
        <div id="form">
            <h2>Add Player</h2>
            <form id="player_form">
                <label for="team">eSports team:</label>
                <select name="team" id="team"></select>
                <br><label for="name">Ingame name:</label>
                <input type="text" id="name" class="name">
                <br><label for="name">Age:</label>
                <input type="number" id="age" class="age">
                <br><label for="pos">Position:</label>
                <select name="pos" id="pos">
                    <option value="player" id="player">Player</option>
                </select>
                <br><label for="status">Status:</label>
                <select name="status" id="status">
                    <option value="main" id="main">Main</option>
                    <option value="subs" id="subs">Substitution</option>
                    <option value="inactive" id="inactive">Inactive</option>
                    <option value="retired" id="retired">Retired</option>
                </select>
                <br><label for="curr">Current Team:</label>
                <input type="text" id="curr" class="curr">
                <div class="form-row">
                    <label for="achievement">Achievement:</label>
                    <textarea id="achievement" class="achievement" rows="5" cols="20"></textarea>
                </div>
                <br><label for="time_played">Time Played:</label>
                <input type="text" id="time_played" class="time_played">
                <br><input type="submit" value="Add" class="btn">
            </form>

            <h2>Update Player</h2>
            <form id="update">
                <label for="name">Ingame name:</label>
                <input type="text" id="update_name" class="name">
                <br><label for="team">eSports team:</label>
                <select name="team" id="update_team"></select>
                <br><label for="name">Age:</label>
                <input type="number" id="update_age" class="age">
                <br><label for="pos">Position:</label>
                <select name="pos" id="update_pos">
                    <option value="player" id="player">Player</option>
                </select>
                <br><label for="status">Status:</label>
                <select name="status" id="update_status">
                    <option value="main" id="main">Main</option>
                    <option value="subs" id="subs">Substitution</option>
                    <option value="inactive" id="inactive">Inactive</option>
                    <option value="retired" id="retired">Retired</option>
                </select>
                <br><label for="curr">Current Team:</label>
                <input type="text" id="update_curr" class="curr">
                <div class="form-row">
                    <label for="achievement">Achievement:</label>
                    <textarea id="update_achievement" class="achievement" rows="5" cols="20"></textarea>
                </div>
                <br><label for="time_played">Time Played:</label>
                <input type="text" id="update_time_played" class="time_played">
                <br>
                <input type="submit" value="Update" class="btn">
                <input type="submit" value="Search" class="btn" id="updatesearchBtn">
            </form>

            <h2>Delete Player</h2>
            <form id="delete">
                <label for="name">Ingame name:</label>
                <input type="text" id="delete_name" class="name">
                <br><label for="team">eSports team:</label>
                <select name="team" id="delete_team"></select>
                <br><label for="name">Age:</label>
                <input type="number" id="delete_age" class="age">
                <br><label for="pos">Position:</label>
                <select name="pos" id="delete_pos">
                    <option value="player" id="player">Player</option>
                </select>
                <br><label for="status">Status:</label>
                <select name="status" id="delete_status">
                    <option value="main" id="main">Main</option>
                    <option value="subs" id="subs">Substitution</option>
                    <option value="inactive" id="inactive">Inactive</option>
                    <option value="retired" id="retired">Retired</option>
                </select>
                <br><label for="curr">Current Team:</label>
                <input type="text" id="delete_curr" class="curr">
                <div class="form-row">
                    <label for="achievement">Achievement:</label>
                    <textarea id="delete_achievement" class="achievement" rows="5" cols="20"></textarea>
                </div>
                <br><label for="time_played">Time Played:</label>
                <input type="text" id="delete_time_played" class="time_played">
                <br>
                <input type="submit" value="Delete" class="btn">
                <input type="submit" value="Search" class="btn" id="deletesearchBtn">
            </form>
        </div>

        <div id="table_player">
            <h2>Show Player</h2>
            <div id="content">
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Position</th>
                            <th>Age</th>
                            <th>Status</th>
                            <th>Game</th>
                            <th>Current Team</th>
                            <th>Achievement</th>
                            <th>Time Played</th>
                        </tr>
                    </thead>
                    <tbody id="legend_list"></tbody>
                </table>
            </div>
            
            <!--<button onclick="deletePlayers()">Delete All</button>-->
            <button onclick="addAge()">+1 years old</button>
            <!--<button onclick="addEsportsTeam()">Add Team</button>-->
        </div>
    </div>
    
</body>
<script>
    /*const bodyId = document.body.id;
    showTeamTransferNews(bodyId);*/

    const team_select = document.getElementById("team");
    team_select.addEventListener('change', () => {
        const team_id = team_select.value;
        showPositions(team_id);
    });

    const update_team_select = document.getElementById("update_team");
    update_team_select.addEventListener('change', () => {
        const update_team_id = update_team_select.value;
        showUpdatePositions(update_team_id);
    });

    const delete_team_select = document.getElementById("delete_team");
    delete_team_select.addEventListener('change', () => {
        const delete_team_id = delete_team_select.value;
        showDeletePositions(delete_team_id);
    });

    document.getElementById('player_form').addEventListener(
    'submit', async (e) => {
        //e.preventDefault();

        const form = e.target;

        const name = form.name.value;
        const team = form.team.value;
        const age = form.age.value;
        const position = form.pos.value;
        const status = form.status.value;
        const current_team = form.curr.value;
        const achievement = form.achievement.value;
        const time_played = form.time_played.value;

        await db.legends.add({ name, team, age, pos: position, status, current_team, achievement, time_played });
        console.log(await db.legends.toArray())

        console.log('Saved to Dexie:', { name, team, age, position, status, current_team, achievement, time_played });

        //form.reset();
    });

    document.getElementById('update').addEventListener(
    'submit', async (e) => {
        //e.preventDefault();

        const name = document.getElementById('update_name').value.trim();
        const team = document.getElementById('update_team').value;

        const updatedData = {
            age: parseInt(document.getElementById('update_age').value),
            position: document.getElementById('update_pos').value,
            status: document.getElementById('update_status').value,
            current_team: document.getElementById('update_curr').value,
            achievement: document.getElementById('update_achievement').value,
            time_played: document.getElementById('update_time_played').value,
        };

        const players = await db.legends
            .where('name')
            .equalsIgnoreCase(name)
            .and(p => p.team === team)
            .toArray();

        if (players.length === 0) {
            alert('Player not found!');
            return;
        }

        for (const player of players) {
            await db.legends.update(player.id, updatedData);
            console.log(`Updated ${player.name} in team ${player.team}`);
        }
    });

    document.getElementById('delete').addEventListener(
    'submit', async (e) => {
        //e.preventDefault();

        const name = document.getElementById('delete_name').value.trim();
        const team = document.getElementById('delete_team').value;

        const updatedData = {
            age: parseInt(document.getElementById('delete_age').value),
            position: document.getElementById('delete_pos').value,
            status: document.getElementById('delete_status').value,
            current_team: document.getElementById('delete_curr').value,
            achievement: document.getElementById('delete_achievement').value,
            time_played: document.getElementById('delete_time_played').value,
        };

        const players = await db.legends
            .where('name')
            .equalsIgnoreCase(name)
            .and(p => p.team === team)
            .toArray();

        if (players.length === 0) {
            alert('Player not found!');
            return;
        }

        for (const player of players) {
            await db.legends.delete(player.id, updatedData);
            console.log(`Deleted ${player.name} in team ${player.team}`);
        }
    });

    document.getElementById('updatesearchBtn').addEventListener(
    'click', async (e) => {
        e.preventDefault();

        const name = document.getElementById('update_name').value;
        
        const player = await db.legends.where('name').equalsIgnoreCase(name).first();

        if (player) {
            const team_update = document.getElementById('update_team');
            team_update.value = player.team;
            await showUpdatePositions(player.team);
            document.getElementById('update_age').value = player.age;
            document.getElementById('update_pos').value = player.pos;
            document.getElementById('update_status').value = player.status;
            document.getElementById('update_curr').value = player.current_team;
            document.getElementById('update_achievement').value = player.achievement;
            document.getElementById('update_time_played').value = player.time_played;
        } else {
            alert('Player not found.');
        }
    });

    document.getElementById('deletesearchBtn').addEventListener(
    'click', async (e) => {
        e.preventDefault();

        const name = document.getElementById('delete_name').value;
        
        const player = await db.legends.where('name').equalsIgnoreCase(name).first();

        if (player) {
            const team_delete = document.getElementById('delete_team');
            team_delete.value = player.team;
            await showDeletePositions(player.team);
            document.getElementById('delete_age').value = player.age;
            document.getElementById('delete_pos').value = player.pos;
            document.getElementById('delete_status').value = player.status;
            document.getElementById('delete_curr').value = player.current_team;
            document.getElementById('delete_achievement').value = player.achievement;
            document.getElementById('delete_time_played').value = player.time_played;
        } else {
            alert('Player not found.');
        }
    });
</script>
</html>